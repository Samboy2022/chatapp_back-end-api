<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laravel + React Native API Connection Guide</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            border-left: 4px solid #3498db;
            padding-left: 15px;
            margin-top: 30px;
        }
        h3 {
            color: #2980b9;
            margin-top: 25px;
        }
        .code-block {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 10px 0;
        }
        .file-path {
            background-color: #e74c3c;
            color: white;
            padding: 5px 10px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 0.9em;
        }
        .success {
            background-color: #d5f4e6;
            border-left: 4px solid #27ae60;
            padding: 10px;
            margin: 10px 0;
        }
        .warning {
            background-color: #fef9e7;
            border-left: 4px solid #f39c12;
            padding: 10px;
            margin: 10px 0;
        }
        .error {
            background-color: #fadbd8;
            border-left: 4px solid #e74c3c;
            padding: 10px;
            margin: 10px 0;
        }
        .step {
            background-color: #ebf3fd;
            border: 1px solid #3498db;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
        }
        .step-number {
            background-color: #3498db;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #3498db;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .ip-highlight {
            background-color: #fff3cd;
            padding: 2px 5px;
            border-radius: 3px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Laravel + React Native API Connection Guide</h1>
        
        <div class="success">
            <strong>‚úÖ Current Status:</strong> API is configured with Pusher Cloud broadcasting. 
            Mobile app needs configuration cache refresh to enable real-time features.
        </div>

        <h2>üìã Quick Reference</h2>
        <table>
            <tr>
                <th>Component</th>
                <th>Current IP/URL</th>
                <th>Port</th>
                <th>Status</th>
            </tr>
            <tr>
                <td>Laravel API</td>
                <td class="ip-highlight">192.168.0.6</td>
                <td>8000</td>
                <td>‚úÖ Running</td>
            </tr>
            <tr>
                <td>Laravel Reverb WebSocket</td>
                <td class="ip-highlight">192.168.0.6</td>
                <td>6001</td>
                <td>‚úÖ Running</td>
            </tr>
            <tr>
                <td>Pusher Cloud API</td>
                <td>ws-mt1.pusher.com</td>
                <td>443 (WSS)</td>
                <td>‚úÖ Configured</td>
            </tr>
            <tr>
                <td>Mobile App (Expo)</td>
                <td class="ip-highlight">192.168.0.6</td>
                <td>8081</td>
                <td>‚úÖ Running</td>
            </tr>
        </table>

        <h2>üîß Step-by-Step Setup Guide</h2>

        <div class="step">
            <h3><span class="step-number">1</span>Find Your Current IP Address</h3>
            <p>First, determine your computer's IP address on the local network:</p>
            <div class="code-block">
# Windows
ipconfig

# Look for "IPv4 Address" under your active network adapter
# Example output: IPv4 Address. . . . . . . . . . . : 192.168.0.6
            </div>
            <div class="warning">
                <strong>‚ö†Ô∏è Important:</strong> Use the actual IP address (e.g., 192.168.0.6), not localhost or 127.0.0.1, 
                so your mobile device can connect to the Laravel server.
            </div>
        </div>

        <div class="step">
            <h3><span class="step-number">2</span>Configure Laravel Backend (.env)</h3>
            <p>Update your Laravel <span class="file-path">chatapp_back-end-api/.env</span> file:</p>
            <div class="code-block">
# App Configuration
APP_URL=http://192.168.0.6:8000

# Database (adjust as needed)
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=chatapp_db
DB_USERNAME=root
DB_PASSWORD=

# Broadcasting Configuration
BROADCAST_DRIVER=pusher

# Pusher Cloud Configuration (Your Credentials)
PUSHER_APP_ID=2012149
PUSHER_APP_KEY=b3652bc3e7cddc5d6f80
PUSHER_APP_SECRET=a58bf3bdccfb58ded089
PUSHER_APP_CLUSTER=mt1

# Laravel Reverb Configuration (for fallback)
REVERB_APP_ID=chatapp-id
REVERB_APP_KEY=chatapp-key
REVERB_APP_SECRET=chatapp-secret
REVERB_HOST=0.0.0.0
REVERB_PORT=6001
            </div>
        </div>

        <div class="step">
            <h3><span class="step-number">3</span>Configure Mobile App (.env)</h3>
            <p>Update your React Native <span class="file-path">mobile_app/.env</span> file:</p>
            <div class="code-block">
# API Configuration - CHANGE IP TO YOUR ACTUAL IP
API_HOST=192.168.0.6
API_PORT=8000
API_SCHEME=http

# WebSocket Configuration
WEBSOCKET_HOST=192.168.0.6
WEBSOCKET_PORT=6001
WEBSOCKET_SCHEME=ws

# Pusher Cloud Configuration
PUSHER_SERVICE_TYPE=pusher_cloud
PUSHER_CLOUD_APP_ID=2012149
PUSHER_CLOUD_APP_KEY=b3652bc3e7cddc5d6f80
PUSHER_CLOUD_APP_SECRET=a58bf3bdccfb58ded089
PUSHER_CLOUD_CLUSTER=mt1
PUSHER_CLOUD_USE_TLS=true

# Generated URLs (automatically created from above)
EXPO_PUBLIC_API_URL=http://192.168.0.6:8000/api
EXPO_PUBLIC_WEBSOCKET_URL=ws://192.168.0.6:6001
            </div>
        </div>

        <div class="step">
            <h3><span class="step-number">4</span>Start Laravel Services</h3>
            <p>Navigate to your Laravel directory and start the required services:</p>
            <div class="code-block">
# Navigate to Laravel directory
cd c:\laragon\www\chat-app-backend\chatapp_back-end-api

# Clear configuration cache
php artisan config:clear
php artisan cache:clear

# Start Laravel development server
php artisan serve --host=0.0.0.0 --port=8000

# In a new terminal, start Laravel Reverb WebSocket server
php artisan reverb:start --host=0.0.0.0 --port=6001
            </div>
        </div>

        <div class="step">
            <h3><span class="step-number">5</span>Start Mobile App</h3>
            <p>Navigate to your mobile app directory and start Expo:</p>
            <div class="code-block">
# Navigate to mobile app directory
cd c:\laragon\www\chat-app-backend\chatapp_back-end-api\mobile_app

# Clear cache and start Expo
npx expo start --clear --reset-cache
            </div>
        </div>

        <h2>üß™ Testing API Connectivity</h2>

        <div class="step">
            <h3><span class="step-number">6</span>Test API Endpoints</h3>
            <p>Use these commands to verify your API is working:</p>
            <div class="code-block">
# Test basic API connection
curl http://192.168.0.6:8000/api/test

# Test app configuration endpoint
curl http://192.168.0.6:8000/api/app-config

# Expected response should include:
# "broadcast_enabled": true
# "broadcast_type": "pusher_cloud"
# "pusher_cloud_app_id": "2012149"
            </div>
        </div>

        <h2>üîÑ Changing IP Address</h2>

        <div class="warning">
            <h3>When Your IP Address Changes</h3>
            <p>If your computer's IP address changes (common with DHCP), you need to update both applications:</p>
            
            <h4>Files to Update:</h4>
            <ol>
                <li><span class="file-path">chatapp_back-end-api/.env</span> - Update APP_URL</li>
                <li><span class="file-path">mobile_app/.env</span> - Update API_HOST and WEBSOCKET_HOST</li>
            </ol>
            
            <h4>After Updating:</h4>
            <ol>
                <li>Restart Laravel server: <code>php artisan serve --host=0.0.0.0 --port=8000</code></li>
                <li>Restart Reverb server: <code>php artisan reverb:start --host=0.0.0.0 --port=6001</code></li>
                <li>Restart mobile app: <code>npx expo start --clear</code></li>
            </ol>
        </div>

        <h2>üö® Troubleshooting Common Issues</h2>

        <div class="error">
            <h3>‚ùå "Network Error" in Mobile App</h3>
            <ul>
                <li>Check if Laravel server is running on correct IP and port</li>
                <li>Verify mobile device is on same WiFi network</li>
                <li>Test API with: <code>curl http://YOUR_IP:8000/api/test</code></li>
                <li>Check Windows Firewall settings</li>
            </ul>
        </div>

        <div class="error">
            <h3>‚ùå "Real-time features disabled"</h3>
            <ul>
                <li>Clear mobile app cache: <code>npx expo start --clear --reset-cache</code></li>
                <li>Verify API returns <code>broadcast_enabled: true</code></li>
                <li>Check Pusher Cloud credentials in database</li>
                <li>Ensure <code>broadcast_driver=pusher</code> in Laravel .env</li>
            </ul>
        </div>

        <div class="error">
            <h3>‚ùå "WebSocket not connected"</h3>
            <ul>
                <li>Verify Pusher Cloud credentials are correct</li>
                <li>Check if <code>pusher_service_type=pusher_cloud</code> in database</li>
                <li>Test WebSocket connection manually</li>
                <li>Ensure mobile app has latest configuration</li>
            </ul>
        </div>

        <h2>üìä Current Configuration Status</h2>
        
        <div class="success">
            <h3>‚úÖ What's Working</h3>
            <ul>
                <li>Laravel API server running on 192.168.0.6:8000</li>
                <li>Laravel Reverb WebSocket server running on port 6001</li>
                <li>Database configured with Pusher Cloud credentials</li>
                <li>API returning correct broadcast configuration</li>
                <li>Mobile app authentication working</li>
                <li>Chat functionality working (without real-time)</li>
            </ul>
        </div>

        <div class="warning">
            <h3>‚ö†Ô∏è Needs Attention</h3>
            <ul>
                <li>Mobile app still using cached configuration</li>
                <li>Real-time features not yet enabled in mobile app</li>
                <li>WebSocket connection not established</li>
            </ul>
        </div>

        <h2>üîß Database Configuration Commands</h2>
        
        <p>If you need to manually update the broadcast configuration in the database:</p>
        <div class="code-block">
# Run this PHP script to update database settings
php update_pusher_config.php

# Or use Laravel Tinker
php artisan tinker

# Then run these commands in Tinker:
App\Models\BroadcastSetting::where('key', 'broadcast_driver')->update(['value' => 'pusher']);
App\Models\BroadcastSetting::where('key', 'pusher_service_type')->update(['value' => 'pusher_cloud']);
App\Models\BroadcastSetting::where('key', 'broadcast_enabled')->update(['value' => 'true']);
        </div>

        <h2>üì± Mobile App Cache Management</h2>
        
        <p>To force the mobile app to fetch fresh configuration:</p>
        <div class="code-block">
# Stop current Expo process (Ctrl+C)

# Clear all caches and restart
npx expo start --clear --reset-cache

# Alternative: Clear specific caches
npx expo r --clear
        </div>

        <div class="success">
            <p><strong>üéØ Next Steps:</strong> The API is correctly configured with Pusher Cloud. 
            The mobile app needs to clear its configuration cache to pick up the new settings and enable real-time features.</p>
        </div>
    </div>
</body>
</html>
