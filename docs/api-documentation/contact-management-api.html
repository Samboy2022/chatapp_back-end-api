<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Management API - FarmersNetwork</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="assets/css/style.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-comments me-2"></i>
                FarmersNetwork API
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="chat-api.html">Chat API</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="contact-management-api.html">Contact API</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="status-api.html">Status API</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="call-api.html">Call API</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="user-management-api.html">User Management</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Header -->
            <div class="row mb-5">
                <div class="col-12">
                    <div class="api-header text-center">
                        <h1 class="display-4 fw-bold text-primary mb-3">
                            <i class="fas fa-address-book me-3"></i>
                            Contact Management API
                        </h1>
                        <p class="lead text-muted">
                            Complete contact synchronization, search, favorites, and blocking functionality
                        </p>
                        <div class="badge bg-success fs-6 mb-3">
                            <i class="fas fa-check-circle me-1"></i>
                            100% Production Ready
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Navigation -->
            <div class="row mb-5">
                <div class="col-12">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title text-primary mb-3">
                                <i class="fas fa-map me-2"></i>
                                Quick Navigation
                            </h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <ul class="list-unstyled">
                                        <li><a href="#sync-contacts" class="text-decoration-none"><i class="fas fa-sync me-2"></i>Contact Synchronization</a></li>
                                        <li><a href="#list-contacts" class="text-decoration-none"><i class="fas fa-list me-2"></i>List Contacts</a></li>
                                        <li><a href="#search-contacts" class="text-decoration-none"><i class="fas fa-search me-2"></i>Search Contacts</a></li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <ul class="list-unstyled">
                                        <li><a href="#favorites" class="text-decoration-none"><i class="fas fa-star me-2"></i>Favorite Management</a></li>
                                        <li><a href="#blocking" class="text-decoration-none"><i class="fas fa-ban me-2"></i>Block/Unblock</a></li>
                                        <li><a href="#mobile-examples" class="text-decoration-none"><i class="fas fa-mobile-alt me-2"></i>Mobile Examples</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contact Synchronization -->
            <section id="sync-contacts" class="mb-5">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h3 class="card-title mb-0">
                            <i class="fas fa-sync me-2"></i>
                            Contact Synchronization
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted mb-4">
                            Sync device contacts with the application to find registered users.
                        </p>

                        <div class="endpoint-card mb-4">
                            <div class="endpoint-header">
                                <span class="badge bg-success me-2">POST</span>
                                <code>/api/contacts/sync</code>
                            </div>
                            <div class="endpoint-body">
                                <h6 class="fw-bold">Request Body:</h6>
                                <pre><code class="language-json">{
    "contacts": [
        {
            "name": "John Farmer",
            "phone": "+1234567890"
        },
        {
            "name": "Sarah Agriculture",
            "phone": "+1234567891"
        }
    ]
}</code></pre>

                                <h6 class="fw-bold mt-4">Response (200 OK):</h6>
                                <pre><code class="language-json">{
    "success": true,
    "data": {
        "synced_contacts": [
            {
                "id": 1,
                "user_id": 123,
                "contact_user_id": 456,
                "contact_name": "John Farmer",
                "is_blocked": false,
                "is_favorite": false,
                "added_at": "2025-07-15T10:30:00Z",
                "contact_user": {
                    "id": 456,
                    "name": "John Farmer",
                    "phone_number": "+1234567890",
                    "avatar_url": "https://example.com/avatar.jpg",
                    "is_online": true,
                    "last_seen_at": "2025-07-15T10:25:00Z"
                }
            }
        ],
        "new_contacts_count": 1,
        "total_synced": 1
    },
    "message": "Contacts synchronized successfully"
}</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- List Contacts -->
            <section id="list-contacts" class="mb-5">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-info text-white">
                        <h3 class="card-title mb-0">
                            <i class="fas fa-list me-2"></i>
                            List All Contacts
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted mb-4">
                            Retrieve all user contacts with pagination support.
                        </p>

                        <div class="endpoint-card mb-4">
                            <div class="endpoint-header">
                                <span class="badge bg-info me-2">GET</span>
                                <code>/api/contacts</code>
                            </div>
                            <div class="endpoint-body">
                                <h6 class="fw-bold">Query Parameters:</h6>
                                <ul>
                                    <li><code>page</code> (optional) - Page number (default: 1)</li>
                                    <li><code>per_page</code> (optional) - Items per page (default: 50)</li>
                                    <li><code>search</code> (optional) - Search by name</li>
                                </ul>

                                <h6 class="fw-bold mt-4">Response (200 OK):</h6>
                                <pre><code class="language-json">{
    "success": true,
    "data": {
        "current_page": 1,
        "data": [
            {
                "id": 1,
                "contact_name": "John Farmer",
                "is_blocked": false,
                "is_favorite": true,
                "added_at": "2025-07-15T10:30:00Z",
                "contact_user": {
                    "id": 456,
                    "name": "John Farmer",
                    "phone_number": "+1234567890",
                    "avatar_url": "https://example.com/avatar.jpg",
                    "is_online": true,
                    "last_seen_at": "2025-07-15T10:25:00Z"
                }
            }
        ],
        "per_page": 50,
        "total": 1
    },
    "message": "Contacts retrieved successfully"
}</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Search Contacts -->
            <section id="search-contacts" class="mb-5">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-warning text-dark">
                        <h3 class="card-title mb-0">
                            <i class="fas fa-search me-2"></i>
                            Search Contacts
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted mb-4">
                            Search for users by name or phone number across all registered users.
                        </p>

                        <div class="endpoint-card mb-4">
                            <div class="endpoint-header">
                                <span class="badge bg-warning text-dark me-2">GET</span>
                                <code>/api/contacts/search</code>
                            </div>
                            <div class="endpoint-body">
                                <h6 class="fw-bold">Query Parameters:</h6>
                                <ul>
                                    <li><code>query</code> (required) - Search term (minimum 3 characters)</li>
                                    <li><code>per_page</code> (optional) - Items per page (default: 20)</li>
                                </ul>

                                <h6 class="fw-bold mt-4">Example Request:</h6>
                                <pre><code class="language-bash">GET /api/contacts/search?query=farmer&per_page=10</code></pre>

                                <h6 class="fw-bold mt-4">Response (200 OK):</h6>
                                <pre><code class="language-json">{
    "success": true,
    "data": {
        "current_page": 1,
        "data": [
            {
                "id": 456,
                "name": "John Farmer",
                "phone_number": "+1234567890",
                "country_code": "+1",
                "avatar_url": "https://example.com/avatar.jpg",
                "is_online": true,
                "last_seen_at": "2025-07-15T10:25:00Z"
            }
        ],
        "per_page": 10,
        "total": 1
    },
    "message": "Users found successfully"
}</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Favorite Management -->
            <section id="favorites" class="mb-5">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-danger text-white">
                        <h3 class="card-title mb-0">
                            <i class="fas fa-star me-2"></i>
                            Favorite Management
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted mb-4">
                            Manage favorite contacts for quick access.
                        </p>

                        <!-- Toggle Favorite -->
                        <div class="endpoint-card mb-4">
                            <div class="endpoint-header">
                                <span class="badge bg-success me-2">POST</span>
                                <code>/api/contacts/favorite/{contactId}</code>
                            </div>
                            <div class="endpoint-body">
                                <h6 class="fw-bold">Path Parameters:</h6>
                                <ul>
                                    <li><code>contactId</code> - User ID to toggle favorite status</li>
                                </ul>

                                <h6 class="fw-bold mt-4">Response (200 OK):</h6>
                                <pre><code class="language-json">{
    "success": true,
    "data": {
        "id": 1,
        "contact_name": "John Farmer",
        "is_favorite": true,
        "is_blocked": false,
        "contact_user": {
            "id": 456,
            "name": "John Farmer",
            "phone_number": "+1234567890",
            "avatar_url": "https://example.com/avatar.jpg"
        }
    },
    "message": "Contact added to favorites"
}</code></pre>
                            </div>
                        </div>

                        <!-- Get Favorites -->
                        <div class="endpoint-card mb-4">
                            <div class="endpoint-header">
                                <span class="badge bg-info me-2">GET</span>
                                <code>/api/contacts/favorites</code>
                            </div>
                            <div class="endpoint-body">
                                <h6 class="fw-bold">Query Parameters:</h6>
                                <ul>
                                    <li><code>per_page</code> (optional) - Items per page (default: 50)</li>
                                </ul>

                                <h6 class="fw-bold mt-4">Response (200 OK):</h6>
                                <pre><code class="language-json">{
    "success": true,
    "data": {
        "current_page": 1,
        "data": [
            {
                "id": 1,
                "contact_name": "John Farmer",
                "is_favorite": true,
                "contact_user": {
                    "id": 456,
                    "name": "John Farmer",
                    "phone_number": "+1234567890",
                    "avatar_url": "https://example.com/avatar.jpg",
                    "is_online": true,
                    "last_seen_at": "2025-07-15T10:25:00Z"
                }
            }
        ],
        "per_page": 50,
        "total": 1
    },
    "message": "Favorite contacts retrieved successfully"
}</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Block/Unblock -->
            <section id="blocking" class="mb-5">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-dark text-white">
                        <h3 class="card-title mb-0">
                            <i class="fas fa-ban me-2"></i>
                            Block/Unblock Functionality
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted mb-4">
                            Block and unblock contacts to control communication.
                        </p>

                        <!-- Block Contact -->
                        <div class="endpoint-card mb-4">
                            <div class="endpoint-header">
                                <span class="badge bg-success me-2">POST</span>
                                <code>/api/contacts/block/{contactId}</code>
                            </div>
                            <div class="endpoint-body">
                                <h6 class="fw-bold">Path Parameters:</h6>
                                <ul>
                                    <li><code>contactId</code> - User ID to block</li>
                                </ul>

                                <h6 class="fw-bold mt-4">Response (200 OK):</h6>
                                <pre><code class="language-json">{
    "success": true,
    "data": {
        "id": 1,
        "contact_name": "John Farmer",
        "is_blocked": true,
        "is_favorite": false,
        "contact_user": {
            "id": 456,
            "name": "John Farmer",
            "phone_number": "+1234567890"
        }
    },
    "message": "Contact blocked successfully"
}</code></pre>
                            </div>
                        </div>

                        <!-- Unblock Contact -->
                        <div class="endpoint-card mb-4">
                            <div class="endpoint-header">
                                <span class="badge bg-success me-2">POST</span>
                                <code>/api/contacts/unblock/{contactId}</code>
                            </div>
                            <div class="endpoint-body">
                                <h6 class="fw-bold">Path Parameters:</h6>
                                <ul>
                                    <li><code>contactId</code> - User ID to unblock</li>
                                </ul>

                                <h6 class="fw-bold mt-4">Response (200 OK):</h6>
                                <pre><code class="language-json">{
    "success": true,
    "data": {
        "id": 1,
        "contact_name": "John Farmer",
        "is_blocked": false,
        "contact_user": {
            "id": 456,
            "name": "John Farmer",
            "phone_number": "+1234567890"
        }
    },
    "message": "Contact unblocked successfully"
}</code></pre>
                            </div>
                        </div>

                        <!-- Get Blocked Contacts -->
                        <div class="endpoint-card mb-4">
                            <div class="endpoint-header">
                                <span class="badge bg-info me-2">GET</span>
                                <code>/api/contacts/blocked</code>
                            </div>
                            <div class="endpoint-body">
                                <h6 class="fw-bold">Query Parameters:</h6>
                                <ul>
                                    <li><code>per_page</code> (optional) - Items per page (default: 50)</li>
                                </ul>

                                <h6 class="fw-bold mt-4">Response (200 OK):</h6>
                                <pre><code class="language-json">{
    "success": true,
    "data": {
        "current_page": 1,
        "data": [
            {
                "id": 1,
                "contact_name": "John Farmer",
                "is_blocked": true,
                "contact_user": {
                    "id": 456,
                    "name": "John Farmer",
                    "phone_number": "+1234567890",
                    "avatar_url": "https://example.com/avatar.jpg"
                }
            }
        ],
        "per_page": 50,
        "total": 1
    },
    "message": "Blocked contacts retrieved successfully"
}</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Mobile Implementation Examples -->
            <section id="mobile-examples" class="mb-5">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-secondary text-white">
                        <h3 class="card-title mb-0">
                            <i class="fas fa-mobile-alt me-2"></i>
                            Mobile Implementation Examples
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted mb-4">
                            Implementation examples for React Native and Flutter applications.
                        </p>

                        <!-- React Native Example -->
                        <div class="mb-4">
                            <h5 class="text-primary">
                                <i class="fab fa-react me-2"></i>
                                React Native Implementation
                            </h5>
                            <pre><code class="language-javascript">// ContactService.js
import AsyncStorage from '@react-native-async-storage/async-storage';
import { Contacts } from 'expo-contacts';

class ContactService {
    constructor() {
        this.baseURL = 'http://192.168.0.102:8000/api';
    }

    async getAuthToken() {
        return await AsyncStorage.getItem('auth_token');
    }

    // Sync device contacts
    async syncContacts() {
        try {
            // Request contacts permission
            const { status } = await Contacts.requestPermissionsAsync();
            if (status !== 'granted') {
                throw new Error('Contacts permission denied');
            }

            // Get device contacts
            const { data } = await Contacts.getContactsAsync({
                fields: [Contacts.Fields.Name, Contacts.Fields.PhoneNumbers],
            });

            // Format contacts for API
            const formattedContacts = data
                .filter(contact => contact.phoneNumbers && contact.phoneNumbers.length > 0)
                .map(contact => ({
                    name: contact.name,
                    phone: contact.phoneNumbers[0].number
                }));

            // Sync with API
            const token = await this.getAuthToken();
            const response = await fetch(`${this.baseURL}/contacts/sync`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`,
                },
                body: JSON.stringify({ contacts: formattedContacts }),
            });

            const result = await response.json();
            if (result.success) {
                return result.data;
            }
            throw new Error(result.message);
        } catch (error) {
            console.error('Contact sync error:', error);
            throw error;
        }
    }

    // Get all contacts
    async getContacts(page = 1, perPage = 50) {
        try {
            const token = await this.getAuthToken();
            const response = await fetch(
                `${this.baseURL}/contacts?page=${page}&per_page=${perPage}`,
                {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                    },
                }
            );

            const result = await response.json();
            if (result.success) {
                return result.data;
            }
            throw new Error(result.message);
        } catch (error) {
            console.error('Get contacts error:', error);
            throw error;
        }
    }

    // Search contacts
    async searchContacts(query) {
        try {
            const token = await this.getAuthToken();
            const response = await fetch(
                `${this.baseURL}/contacts/search?query=${encodeURIComponent(query)}`,
                {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                    },
                }
            );

            const result = await response.json();
            if (result.success) {
                return result.data;
            }
            throw new Error(result.message);
        } catch (error) {
            console.error('Search contacts error:', error);
            throw error;
        }
    }

    // Toggle favorite
    async toggleFavorite(contactId) {
        try {
            const token = await this.getAuthToken();
            const response = await fetch(
                `${this.baseURL}/contacts/favorite/${contactId}`,
                {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                    },
                }
            );

            const result = await response.json();
            if (result.success) {
                return result.data;
            }
            throw new Error(result.message);
        } catch (error) {
            console.error('Toggle favorite error:', error);
            throw error;
        }
    }

    // Block contact
    async blockContact(contactId) {
        try {
            const token = await this.getAuthToken();
            const response = await fetch(
                `${this.baseURL}/contacts/block/${contactId}`,
                {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                    },
                }
            );

            const result = await response.json();
            if (result.success) {
                return result.data;
            }
            throw new Error(result.message);
        } catch (error) {
            console.error('Block contact error:', error);
            throw error;
        }
    }
}

export default new ContactService();</code></pre>
                        </div>

                        <!-- Flutter Example -->
                        <div class="mb-4">
                            <h5 class="text-info">
                                <i class="fas fa-mobile me-2"></i>
                                Flutter Implementation
                            </h5>
                            <pre><code class="language-dart">// contact_service.dart
import 'dart:convert';
import 'package:http/http.dart' as http;
import 'package:contacts_service/contacts_service.dart';
import 'package:permission_handler/permission_handler.dart';
import 'package:shared_preferences/shared_preferences.dart';

class ContactService {
  static const String baseURL = 'http://192.168.0.102:8000/api';

  Future&lt;String?&gt; getAuthToken() async {
    final prefs = await SharedPreferences.getInstance();
    return prefs.getString('auth_token');
  }

  // Sync device contacts
  Future&lt;Map&lt;String, dynamic&gt;&gt; syncContacts() async {
    try {
      // Request contacts permission
      if (await Permission.contacts.request().isGranted) {
        // Get device contacts
        Iterable&lt;Contact&gt; contacts = await ContactsService.getContacts();

        // Format contacts for API
        List&lt;Map&lt;String, String&gt;&gt; formattedContacts = contacts
            .where((contact) =&gt; contact.phones != null && contact.phones!.isNotEmpty)
            .map((contact) =&gt; {
                  'name': contact.displayName ?? '',
                  'phone': contact.phones!.first.value ?? '',
                })
            .toList();

        // Sync with API
        final token = await getAuthToken();
        final response = await http.post(
          Uri.parse('$baseURL/contacts/sync'),
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer $token',
          },
          body: jsonEncode({'contacts': formattedContacts}),
        );

        final result = jsonDecode(response.body);
        if (result['success']) {
          return result['data'];
        }
        throw Exception(result['message']);
      } else {
        throw Exception('Contacts permission denied');
      }
    } catch (error) {
      print('Contact sync error: $error');
      rethrow;
    }
  }

  // Get all contacts
  Future&lt;Map&lt;String, dynamic&gt;&gt; getContacts({int page = 1, int perPage = 50}) async {
    try {
      final token = await getAuthToken();
      final response = await http.get(
        Uri.parse('$baseURL/contacts?page=$page&per_page=$perPage'),
        headers: {
          'Authorization': 'Bearer $token',
        },
      );

      final result = jsonDecode(response.body);
      if (result['success']) {
        return result['data'];
      }
      throw Exception(result['message']);
    } catch (error) {
      print('Get contacts error: $error');
      rethrow;
    }
  }

  // Search contacts
  Future&lt;Map&lt;String, dynamic&gt;&gt; searchContacts(String query) async {
    try {
      final token = await getAuthToken();
      final response = await http.get(
        Uri.parse('$baseURL/contacts/search?query=${Uri.encodeComponent(query)}'),
        headers: {
          'Authorization': 'Bearer $token',
        },
      );

      final result = jsonDecode(response.body);
      if (result['success']) {
        return result['data'];
      }
      throw Exception(result['message']);
    } catch (error) {
      print('Search contacts error: $error');
      rethrow;
    }
  }

  // Toggle favorite
  Future&lt;Map&lt;String, dynamic&gt;&gt; toggleFavorite(int contactId) async {
    try {
      final token = await getAuthToken();
      final response = await http.post(
        Uri.parse('$baseURL/contacts/favorite/$contactId'),
        headers: {
          'Authorization': 'Bearer $token',
        },
      );

      final result = jsonDecode(response.body);
      if (result['success']) {
        return result['data'];
      }
      throw Exception(result['message']);
    } catch (error) {
      print('Toggle favorite error: $error');
      rethrow;
    }
  }

  // Block contact
  Future&lt;Map&lt;String, dynamic&gt;&gt; blockContact(int contactId) async {
    try {
      final token = await getAuthToken();
      final response = await http.post(
        Uri.parse('$baseURL/contacts/block/$contactId'),
        headers: {
          'Authorization': 'Bearer $token',
        },
      );

      final result = jsonDecode(response.body);
      if (result['success']) {
        return result['data'];
      }
      throw Exception(result['message']);
    } catch (error) {
      print('Block contact error: $error');
      rethrow;
    }
  }
}</code></pre>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Prism.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <!-- Custom JS -->
    <script src="assets/js/main.js"></script>
</body>
</html>
