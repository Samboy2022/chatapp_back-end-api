<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="test-token-12345">
    <title>Admin Panel Functions Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <div class="card">
            <div class="card-header">
                <h3>🧪 Admin Panel Functions Test</h3>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <h5><i class="fas fa-info-circle"></i> Test Purpose</h5>
                    <p>This page tests if the admin panel JavaScript functions are properly defined and working.</p>
                </div>

                <!-- Test Results -->
                <div id="test-results"></div>

                <!-- Function Test Buttons -->
                <div class="row">
                    <div class="col-md-12">
                        <h5>🔧 Function Availability Tests</h5>
                        <div class="row">
                            <div class="col-md-3">
                                <button class="btn btn-primary btn-sm w-100 mb-2" onclick="testFunction('saveSettings')">
                                    <i class="fas fa-save"></i> saveSettings
                                </button>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-info btn-sm w-100 mb-2" onclick="testFunction('showAlert')">
                                    <i class="fas fa-bell"></i> showAlert
                                </button>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-warning btn-sm w-100 mb-2" onclick="testFunction('resetForm')">
                                    <i class="fas fa-undo"></i> resetForm
                                </button>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-success btn-sm w-100 mb-2" onclick="testFunction('quickEnableBroadcasting')">
                                    <i class="fas fa-play"></i> quickEnable
                                </button>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-3">
                                <button class="btn btn-danger btn-sm w-100 mb-2" onclick="testFunction('quickDisableBroadcasting')">
                                    <i class="fas fa-stop"></i> quickDisable
                                </button>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-secondary btn-sm w-100 mb-2" onclick="testFunction('switchToReverb')">
                                    <i class="fas fa-server"></i> switchReverb
                                </button>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-dark btn-sm w-100 mb-2" onclick="testFunction('switchToPusherCloud')">
                                    <i class="fas fa-cloud"></i> switchPusher
                                </button>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-outline-primary btn-sm w-100 mb-2" onclick="testFunction('updateSingleSetting')">
                                    <i class="fas fa-edit"></i> updateSetting
                                </button>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <button class="btn btn-outline-info btn-sm w-100 mb-2" onclick="testFunction('refreshStatus')">
                                    <i class="fas fa-sync"></i> refreshStatus
                                </button>
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-outline-success btn-sm w-100 mb-2" onclick="testFunction('updateConnectionStatus')">
                                    <i class="fas fa-wifi"></i> updateConnection
                                </button>
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-outline-warning btn-sm w-100 mb-2" onclick="testFunction('notifyMobileApps')">
                                    <i class="fas fa-mobile"></i> notifyMobile
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <hr>

                <!-- Comprehensive Tests -->
                <div class="row">
                    <div class="col-md-6">
                        <button class="btn btn-primary w-100" onclick="testAllFunctions()">
                            <i class="fas fa-check-double"></i> Test All Functions
                        </button>
                    </div>
                    <div class="col-md-6">
                        <button class="btn btn-secondary w-100" onclick="clearResults()">
                            <i class="fas fa-trash"></i> Clear Results
                        </button>
                    </div>
                </div>

                <!-- Function Status Summary -->
                <div class="mt-4">
                    <h5>📊 Function Status Summary</h5>
                    <div id="function-summary" class="row">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Required functions list
        const requiredFunctions = [
            'saveSettings',
            'resetForm', 
            'showAlert',
            'quickEnableBroadcasting',
            'quickDisableBroadcasting',
            'switchToReverb',
            'switchToPusherCloud',
            'updateSingleSetting',
            'refreshStatus',
            'updateConnectionStatus',
            'updateStatusDisplay',
            'notifyMobileApps',
            'updateUIAfterSettingChange'
        ];

        function testFunction(functionName) {
            const isDefined = typeof window[functionName] === 'function';
            const status = isDefined ? 'success' : 'danger';
            const icon = isDefined ? 'check-circle' : 'times-circle';
            const message = isDefined ? 'Function is defined and available' : 'Function is NOT defined';

            showTestResult(
                `${functionName} Test`,
                isDefined,
                message,
                isDefined ? 'Function can be called from global scope' : 'Function is missing or not in global scope'
            );

            updateFunctionSummary();
        }

        function testAllFunctions() {
            showTestResult('Comprehensive Test', true, 'Testing all required functions...', 'Please wait...');

            let allDefined = true;
            let results = [];

            requiredFunctions.forEach(funcName => {
                const isDefined = typeof window[funcName] === 'function';
                if (!isDefined) {
                    allDefined = false;
                }
                results.push(`${isDefined ? '✅' : '❌'} ${funcName}: ${isDefined ? 'Defined' : 'Missing'}`);
            });

            setTimeout(() => {
                showTestResult(
                    'All Functions Test',
                    allDefined,
                    allDefined ? 'All required functions are defined!' : 'Some functions are missing',
                    results.join('<br>')
                );
                updateFunctionSummary();
            }, 500);
        }

        function updateFunctionSummary() {
            const summaryDiv = document.getElementById('function-summary');
            let definedCount = 0;
            let totalCount = requiredFunctions.length;

            let summaryHtml = '';

            requiredFunctions.forEach(funcName => {
                const isDefined = typeof window[funcName] === 'function';
                if (isDefined) definedCount++;

                const badgeClass = isDefined ? 'bg-success' : 'bg-danger';
                const icon = isDefined ? 'check' : 'times';

                summaryHtml += `
                    <div class="col-md-3 mb-2">
                        <span class="badge ${badgeClass} w-100">
                            <i class="fas fa-${icon}"></i> ${funcName}
                        </span>
                    </div>
                `;
            });

            // Add overall status
            const overallStatus = definedCount === totalCount ? 'success' : 'warning';
            const overallIcon = definedCount === totalCount ? 'check-circle' : 'exclamation-triangle';

            summaryHtml = `
                <div class="col-12 mb-3">
                    <div class="alert alert-${overallStatus}">
                        <h6><i class="fas fa-${overallIcon}"></i> Overall Status: ${definedCount}/${totalCount} functions defined</h6>
                    </div>
                </div>
            ` + summaryHtml;

            summaryDiv.innerHTML = summaryHtml;
        }

        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
        }

        function showTestResult(title, success, message, details = null) {
            const resultsDiv = document.getElementById('test-results');
            const alertClass = success ? 'alert-success' : 'alert-danger';
            const icon = success ? 'check-circle' : 'exclamation-triangle';
            
            const resultHtml = `
                <div class="alert ${alertClass} alert-dismissible fade show">
                    <h6><i class="fas fa-${icon}"></i> ${title}</h6>
                    <p class="mb-1">${message}</p>
                    ${details ? `<small class="text-muted">${details}</small>` : ''}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            resultsDiv.innerHTML = resultHtml + resultsDiv.innerHTML;
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            showTestResult('Page Loaded', true, 'Admin Panel Functions Test initialized', 'Ready to test function availability');
            updateFunctionSummary();
        });
    </script>
</body>
</html>
